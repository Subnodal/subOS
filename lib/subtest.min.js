!function(s){if(!s.SUBMODULES_VERSION){s.SUBMODULES_VERSION="1.0.0",s.SUBMODULES_VERNUM=0,s.namespaces={};class e{}class t{}s.require=function(e){return n(e),s.namespaces[e]},s.namespace=function(e,i){n(e);var o=new t;for(var a in i(o),o)s.namespaces[e][a]=o[a]}}function n(n){n in s.namespaces||(s.namespaces[n]=new e)}}(this),namespace("com.subnodal.subtest",(function(s){var n=[],e=null;function t(s,n="info"){var t=document.createElement("div");for(var i in t.style)t.style[i]="inherit";switch(n){case"pass":t.style.color="green";break;case"fail":t.style.color="red";break;case"running":t.style.color="blue";break;default:t.style.color="white"}t.innerText=s,e.appendChild(t)}s.TestError=class extends Error{constructor(s){super(s),this.name="TestError"}},s.PromiseError=class extends Error{constructor(s){super(s),this.name="PromiseError"}},s.PassCondition=class{constructor(){this.passed=null,this.failReason=null}run(s){throw new Error("Test pass condition has not been overridden")}},s.RunWithoutErrorPassCondition=class extends s.PassCondition{run(s){try{s(),this.passed=!0}catch(s){this.passed=!1,this.failReason=s}}},s.EqualityPassCondition=class extends s.PassCondition{constructor(s){super(),this.expected=s}run(n){try{this.passed=n()==this.expected,this.failReason=n()!=this.expected?new s.TestError("Unmet equality"):null}catch(s){this.passed=!1,this.failReason=s}}},s.PromiseResolutionPassCondition=class extends s.PassCondition{run(n){var e=this;try{n().then((()=>this.passed=!0)).catch((function(n){e.passed=!1,e.failReason=new s.PromiseError(n)}))}catch(s){this.passed=!1,this.failReason=s}}},s.PromiseResolutionEqualityPassCondition=class extends s.EqualityPassCondition{run(n){var e=this;try{n().then((function(n){e.passed=n==e.expected,e.failReason=n!=e.expected?new s.TestError("Unmet equality"):null})).catch((function(n){e.passed=!1,e.failReason=new s.PromiseError(n)}))}catch(s){this.passed=!1,this.failReason=s}}},s.PromiseRejectionPassCondition=class extends s.PassCondition{run(n){var e=this;try{n().then((function(){e.passed=!1,e.failReason=new s.TestError("No promise rejection was made")})).catch((()=>this.passed=!0))}catch(s){this.passed=!1,this.failReason=s}}},s.PromiseRejectionEqualityPassCondition=class extends s.EqualityPassCondition{run(n){var e=this;try{n().then((function(){e.passed=!1,e.failReason=new s.TestError("No promise rejection was made")})).catch((function(){e.passed=i==e.expected,e.failReason=i!=e.expected?new s.TestError("Unmet equality"):null}))}catch(s){this.passed=!1,this.failReason=s}}},s.ThrowPassCondition=class extends s.EqualityPassCondition{run(n){try{n(),this.passed=!1,this.failReason=new s.TestError("Code ran without throwing an error")}catch(s){if(null==this.expected)return void(this.passed=!0);this.passed=s.name==this.expected.name&&s.message==this.expected.message,this.passed||(this.failReason=s)}}},s.DeferredPassCondition=class extends s.PassCondition{constructor(s){super(),this.subsequentPassCondition=s,this.waiting=!0}run(n){var e=this;n().then((function(s){e.waiting=!1,e.subsequentPassCondition.run(s);var n=setInterval((function(){e.passed=e.subsequentPassCondition.passed,e.failReason=e.subsequentPassCondition.failReason,null!=e.passed&&clearInterval(n)}))})).catch((function(n){e.passed=!1,e.failReason=new s.TestError(n)}))}},s.Test=class{constructor(n){this.testableCode=n,this.passCondition=new s.RunWithoutErrorPassCondition}shouldRun(){return this.passCondition=new s.RunWithoutErrorPassCondition,this}shouldEqual(n=!0){return this.passCondition=new s.EqualityPassCondition(n),this}shouldResolve(){return this.passCondition=new s.PromiseResolutionPassCondition,this}shouldResolveTo(n=!0){return this.passCondition=new s.PromiseResolutionEqualityPassCondition(n),this}shouldReject(){return this.passCondition=new s.PromiseRejectionPassCondition,this}shouldRejectTo(n=!0){return this.passCondition=new s.PromiseRejectionEqualityPassCondition(n),this}shouldThrow(n=null){return this.passCondition=new s.ThrowPassCondition(n),this}after(n,e=!1){var t=this.testableCode.bind({});return this.testableCode=function(){return new Promise((function(s,i){var o=setInterval((function(){null!=n.passCondition.passed&&(clearInterval(o),1!=n.passCondition.passed&&e?i("Test is dependent on another test's success"):s(t))}))}))},this.passCondition=new s.DeferredPassCondition(this.passCondition),this}},s.registerUpdateCallback=function(s){n.push(s)},s.runTests=function(s){for(var e in s)s[e].passCondition.run(s[e].testableCode);return new Promise((function(e,t){var i=setInterval((function(){var o=!1,a=!1;for(var r in s)null==s[r].passCondition.passed&&(o=!0),0==s[r].passCondition.passed&&(a=!0);n.forEach((n=>n(s))),o||(a?t(s):e(s),clearTimeout(i))}))}))},s.runTestsOnWeb=function(n){for(var i in(e=document.createElement("pre")).style)e.style[i]="initial";return Object.assign(e.style,{position:"fixed",bottom:"0",left:"0",width:"100%",height:"20vh",margin:"0",padding:"0.5em","box-sizing":"border-box","background-color":"black",color:"white","font-size":"1em","font-family":'"Overpass Mono", monospace',overflow:"auto","z-index":String(Math.pow(2,31)-1)}),s.registerUpdateCallback((function(n){e.innerHTML="";var i=0,o=0,a=0;for(var r in n)switch(n[r].passCondition.passed){case!0:i++;break;case!1:o++;break;default:a++}for(var r in t(`Tests passed: ${i} of ${i+o+a} (${o} failed, ${a} running) ${Math.round(i/(i+o+a)*100)}%`,"info"),n){var d="running",c="⏳ WAIT: ";1==n[r].passCondition.passed?(d="pass",c="✅ PASS: "):0==n[r].passCondition.passed?(d="fail",c="❌ FAIL: "):n[r].passCondition instanceof s.DeferredPassCondition&&n[r].passCondition.waiting&&(d="running",c="⏳ WAIT (deferred): "),0!=n[r].passCondition.passed?t(c+r,d):t(c+r+` (${null==n[r].passCondition.failReason?"Unknown error":n[r].passCondition.failReason.toString()})`,d)}})),document.body.appendChild(e),s.runTests(n)}}));